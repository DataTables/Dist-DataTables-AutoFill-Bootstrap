/*!
 AutoFill 2.1.0-dev
 Â©2008-2015 SpryMedia Ltd - datatables.net/license
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],e):"object"===typeof exports?module.exports=function(g){g||(g=require("jquery"));g.fn.dataTable||require("datatables.net")(g);e(g)}:e(jQuery)})(function(e){var g=e.fn.dataTable,o=0,i=function(c,a){if(!g.versionCheck||!g.versionCheck("1.10.8"))throw"Warning: AutoFill requires DataTables 1.10.8 or greater";this.c=e.extend(!0,{},g.defaults.autoFill,i.defaults,a);this.s={dt:new g.Api(c),namespace:".autoFill"+o++,scroll:{},
scrollInterval:null,handle:{height:0,width:0}};this.dom={handle:e('<div class="dt-autofill-handle"/>'),select:{top:e('<div class="dt-autofill-select top"/>'),right:e('<div class="dt-autofill-select right"/>'),bottom:e('<div class="dt-autofill-select bottom"/>'),left:e('<div class="dt-autofill-select left"/>')},background:e('<div class="dt-autofill-background"/>'),list:e('<div class="dt-autofill-list">'+this.s.dt.i18n("autoFill.info","")+"<ul/></div>"),dtScroll:null,offsetParent:null};this._constructor()};
e.extend(i.prototype,{_constructor:function(){var c=this,a=this.s.dt,b=e("div.dataTables_scrollBody",this.s.dt.table().container());b.length&&(this.dom.dtScroll=b,"static"===b.css("position")&&b.css("position","relative"));this._focusListener();this.dom.handle.on("mousedown",function(a){c._mousedown(a);return false});a.on("destroy.autoFill",function(){a.off(".autoFill");e(a.table().body()).off(c.s.namespace);e(document.body).off(c.s.namespace)})},_attach:function(c){var a=this.s.dt,b=a.cell(c).index(),
d=this.dom.handle,f=this.s.handle;if(!b||-1===a.columns(this.c.columns).indexes().indexOf(b.column))this._detach();else{this.dom.offsetParent||(this.dom.offsetParent=e(c).offsetParent());if(!f.height||!f.width)d.appendTo("body"),f.height=d.outerHeight(),f.width=d.outerWidth();a=e(c).position();this.dom.attachedTo=c;d.css({top:a.top+c.offsetHeight-f.height,left:a.left+c.offsetWidth-f.width}).appendTo(this.dom.offsetParent)}},_actionSelector:function(c){var a=this,b=this.s.dt,d=i.actions,f=[];e.each(d,
function(a,d){d.available(b,c)&&f.push(a)});if(1===f.length&&!1===this.c.alwaysAsk){var j=d[f[0]].execute(b,c);this._update(j,c)}else{var h=this.dom.list.children("ul").empty();f.push("cancel");e.each(f,function(f,j){h.append(e("<li/>").append('<div class="dt-autofill-question">'+d[j].option(b,c)+"<div>").append(e('<div class="dt-autofill-button">').append(e('<button class="'+i.classes.btn+'">'+b.i18n("autoFill.button","&gt;")+"</button>").on("click",function(){var f=d[j].execute(b,c,e(this).closest("li"));
a._update(f,c);a.dom.background.remove();a.dom.list.remove()}))))});this.dom.background.appendTo("body");this.dom.list.appendTo("body");this.dom.list.css("margin-top",-1*(this.dom.list.outerHeight()/2))}},_detach:function(){this.dom.attachedTo=null;this.dom.handle.detach()},_drawSelection:function(c){var a=this.s.dt,b=this.s.start,d=e(this.dom.start),f=e(c),j={row:f.parent().index(),column:f.index()};if(a.cell(f).any()&&-1!==a.columns(this.c.columns).indexes().indexOf(j.column)){this.s.end=j;var h,
a=b.row<j.row?d:f;h=b.row<j.row?f:d;c=b.column<j.column?d:f;d=b.column<j.column?f:d;a=a.position().top;c=c.position().left;b=h.position().top+h.outerHeight()-a;d=d.position().left+d.outerWidth()-c;if(f=this.dom.dtScroll)a+=f.scrollTop(),c+=f.scrollLeft();f=this.dom.select;f.top.css({top:a,left:c,width:d});f.left.css({top:a,left:c,height:b});f.bottom.css({top:a+b,left:c,width:d});f.right.css({top:a,left:c+d,height:b})}},_editor:function(c){var a=this.s.dt,b=this.c.editor;if(b){for(var d={},f=[],e=
b.fields(),h=0,g=c.length;h<g;h++)for(var i=0,k=c[h].length;i<k;i++){var n=c[h][i],l=a.settings()[0].aoColumns[n.index.column],m=l.editField;if(void 0===m)for(var l=l.mData,p=0,o=e.length;p<o;p++){var q=b.field(e[p]);if(q.dataSrc()===l){m=q.name();break}}if(!m)throw"Could not automatically determine field data. Please see https://datatables.net/tn/11";d[m]||(d[m]={});l=a.row(n.index.row).id();d[m][l]=n.set;f.push(n.index)}b.bubble(f,!1).multiSet(d).submit()}},_emitEvent:function(c,a){this.s.dt.iterator("table",
function(b){e(b.nTable).triggerHandler(c+".dt",a)})},_focusListener:function(){var c=this,a=this.s.dt,b=this.s.namespace,d=null!==this.c.focus?this.c.focus:a.settings()[0].keytable?"focus":"hover";if("focus"===d)a.on("key-focus.autoFill",function(a,b,d){c._attach(d.node())}).on("key-blur.autoFill",function(){c._detach()});else if("click"===d)e(a.table().body()).on("click"+b,"td, th",function(){c._attach(this)}),e(document.body).on("click"+b,function(b){e(b.target).parents().filter(a.table().body()).length||
c._detach()});else e(a.table().body()).on("mouseenter"+b,"td, th",function(){c._attach(this)}).on("mouseleave"+b,function(a){e(a.relatedTarget).hasClass("dt-autofill-handle")||c._detach()})},_mousedown:function(c){var a=this;this.dom.start=this.dom.attachedTo;this.s.start={row:e(this.dom.start).parent().index(),column:e(this.dom.start).index()};e(document.body).on("mousemove.autoFill",function(b){a._mousemove(b)}).on("mouseup.autoFill",function(b){a._mouseup(b)});var b=this.dom.select,d=e(this.s.dt.table().body()).offsetParent();
b.top.appendTo(d);b.left.appendTo(d);b.right.appendTo(d);b.bottom.appendTo(d);this._drawSelection(this.dom.start,c);this.dom.handle.css("display","none");c=this.dom.dtScroll;this.s.scroll={windowHeight:e(window).height(),windowWidth:e(window).width(),dtTop:c?c.offset().top:null,dtLeft:c?c.offset().left:null,dtHeight:c?c.outerHeight():null,dtWidth:c?c.outerWidth():null}},_mousemove:function(c){var a=c.target.nodeName.toLowerCase();"td"!==a&&"th"!==a||(this._drawSelection(c.target,c),this._shiftScroll(c))},
_mouseup:function(){e(document.body).off(".autoFill");var c=this.s.dt,a=this.dom.select;a.top.remove();a.left.remove();a.right.remove();a.bottom.remove();this.dom.handle.css("display","block");var a=this.s.start,b=this.s.end;if(!(a.row===b.row&&a.column===b.column)){for(var d=this._range(a.row,b.row),a=this._range(a.column,b.column),b=[],f=0;f<d.length;f++)b.push(e.map(a,function(a){a=c.cell(":eq("+d[f]+")",a+":visible",{page:"current"});return{cell:a,data:a.data(),index:a.index()}}));this._actionSelector(b)}},
_range:function(c,a){var b=[],d;if(c<=a)for(d=c;d<=a;d++)b.push(d);else for(d=c;d>=a;d--)b.push(d);return b},_shiftScroll:function(c){var a=this,b=this.s.scroll,d=!1,f=c.pageY-document.body.scrollTop,e=c.pageX-document.body.scrollLeft,h,g,i,k;65>f?h=-5:f>b.windowHeight-65&&(h=5);65>e?g=-5:e>b.windowWidth-65&&(g=5);null!==b.dtTop&&c.pageY<b.dtTop+65?i=-5:null!==b.dtTop&&c.pageY>b.dtTop+b.dtHeight-65&&(i=5);null!==b.dtLeft&&c.pageX<b.dtLeft+65?k=-5:null!==b.dtLeft&&c.pageX>b.dtLeft+b.dtWidth-65&&(k=
5);h||g||i||k?(b.windowVert=h,b.windowHoriz=g,b.dtVert=i,b.dtHoriz=k,d=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null);!this.s.scrollInterval&&d&&(this.s.scrollInterval=setInterval(function(){if(b.windowVert)document.body.scrollTop=document.body.scrollTop+b.windowVert;if(b.windowHoriz)document.body.scrollLeft=document.body.scrollLeft+b.windowHoriz;if(b.dtVert||b.dtHoriz){var c=a.dom.dtScroll[0];if(b.dtVert)c.scrollTop=c.scrollTop+b.dtVert;if(b.dtHoriz)c.scrollLeft=
c.scrollLeft+b.dtHoriz}},20))},_update:function(c,a){if(!1!==c){var b=this.s.dt,d;this._emitEvent("preAutoFill",[b,a]);this._editor(a);if(null!==this.c.update?this.c.update:!this.c.editor){for(var f=0,e=a.length;f<e;f++)for(var h=0,g=a[f].length;h<g;h++)d=a[f][h],d.cell.data(d.set);b.draw(!1)}this._emitEvent("autoFill",[b,a])}}});i.actions={increment:{available:function(c,a){return e.isNumeric(a[0][0].data)},option:function(c){return c.i18n("autoFill.increment",'Increment / decrement each cell by: <input type="number" value="1">')},
execute:function(c,a,b){for(var c=1*a[0][0].data,b=1*e("input",b).val(),d=0,f=a.length;d<f;d++)for(var j=0,h=a[d].length;j<h;j++)a[d][j].set=c,c+=b}},fill:{available:function(){return!0},option:function(c,a){return c.i18n("autoFill.fill","Fill all cells with <i>"+a[0][0].data+"</i>")},execute:function(c,a){for(var b=a[0][0].data,d=0,f=a.length;d<f;d++)for(var e=0,h=a[d].length;e<h;e++)a[d][e].set=b}},fillHorizontal:{available:function(c,a){return 1<a.length&&1<a[0].length},option:function(c){return c.i18n("autoFill.fillHorizontal",
"Fill cells horizontally")},execute:function(c,a){for(var b=0,d=a.length;b<d;b++)for(var f=0,e=a[b].length;f<e;f++)a[b][f].set=a[b][0].data}},fillVertical:{available:function(c,a){return 1<a.length&&1<a[0].length},option:function(c){return c.i18n("autoFill.fillVertical","Fill cells vertically")},execute:function(c,a){for(var b=0,d=a.length;b<d;b++)for(var e=0,g=a[b].length;e<g;e++)a[b][e].set=a[0][e].data}},cancel:{available:function(){return!1},option:function(c){return c.i18n("autoFill.cancel",
"Cancel")},execute:function(){return!1}}};i.version="2.1.0-dev";i.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null};i.classes={btn:"btn"};e(document).on("init.dt.autofill",function(c,a){if("dt"===c.namespace){var b=a.oInit.autoFill,d=g.defaults.autoFill;if(b||d)d=e.extend({},b,d),!1!==b&&new i(a,d)}});g.AutoFill=i;return g.AutoFill=i});
